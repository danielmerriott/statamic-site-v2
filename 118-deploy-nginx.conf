#
# git-deploy.site.openleaf.co.nz
#
server {
    server_name     git-deploy.site.openleaf.co.nz;
    root            /data/www/openleaf-co-nz/htdocs/git-deploy;
    access_log      /data/www/openleaf-co-nz/logs/118-deploy-nginx.log;
    error_log       /data/www/openleaf-co-nz/logs/118-deploy-nginx.err info;

    # Use index.php as directory index file
    index index.php;

    # Deny access to the 'lib' directory
    location ~ /lib {
        deny all;
    }

    # Serve the file/directory or pass to php
    location / {
        try_files $uri $uri/ /index.php?$args;
    }	 

    # Pass PHP requests on to PHP-FPM
    location ~* \.php$ {
        try_files  $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/var/run/php5-fpm-git-deploy.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}
